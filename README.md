# url_shortener

## Функционал

Сервис используется для создания и хранения коротких ссылок.  
Все сокращённые ссылки имеют длину 10 и состоят из:
- символов латинского алфавита в нижнем и верхнем регистрах
- цифр
- символа подчёркивания
  
## Детали

Сервис работает через gRPC с gRPC gateway, что позволяет отправлять запросы как используя gRPC, так и по http.  

В сервисе реализовано два эндпоинта:
1. Метод Post, который сохраняет оригинальный URL в базе и возвращает сокращённый.
2. Метод Get, который принимает сокращённый URL и возвращать оригинальный

При старте сервиса можно выбрать с каким хранилищем работать:
- PostgeSQL
- In-memory

Также сервис упакован в docker файл, а для удобного использования и в docker-compose.

## Запуск

Для начала стоит склонировать репозиторий:
```githubexpressionlanguage
git clone https://github.com/k1v4/url_shortener.git
```

Предварительно стоит позаботиться, чтобы порты 8080 и 5432 были свободны. (или же можно их переопределить в .env файле или в docker-compose)

### docker-compose

Далее стоит перейти в папку репозитория и использовать команду для старта docker compose(потребуется Docker для запуска системы):
```githubexpressionlanguage
DB_VALUE=postgres docker-compose up
```
где в качестве значения переменной `DB_VALUE` укажите один из двух параметров для выбора хранилища:
- `postgres` для PostgeSQL
- `in_memory` для In-memory

по умолчанию стоит In-memory(т.е если не будет указан никакой, то выберется In-memory). При неверном флаге тоже будет выбрано In-memory хранилище

### docker 

Если же вам чем-то не подходить compose файл, то можно запустить и отдельно контейнер.  
Для этого в консоли надо последовательно ввести две команды:
```dockerfile
docker build -t url_shortener:last .
```

а потом:
```dockerfile
docker run -p 8080:8080 -p 50051:50051 --name url_shortener url_shortener:last /app --db "postgres"
```
где флаг `--db` отвечает за выбор хранилища. Тут всё работает как в пункте выше:
- `postgres` для PostgeSQL
- `in_memory` для In-memory

Если же у вас установлена утилита make, то можно воспользоваться ей, и ввести в консоль:
```makefile
make
```
но в таком случае для изменения типа хранилиза надо будет зайти в `makefile` и всё также поменять параметр `--db` на нужный